(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function i(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(n){if(n.ep)return;n.ep=!0;const r=i(n);fetch(n.href,r)}})();const l={GEOCODING_API:"https://geocoding-api.open-meteo.com/v1/search",WEATHER_API:"https://api.open-meteo.com/v1/forecast",STORAGE_KEY_FAVORITES:"meteo-pwa-favorites",STORAGE_KEY_THEME:"meteo-pwa-theme",RAIN_CODES:[51,53,55,56,57,61,63,65,66,67,71,73,75,77,80,81,82,85,86,95,96,99],TEMP_THRESHOLD:10},t={cityInput:document.getElementById("city-input"),searchBtn:document.getElementById("search-btn"),notifyBtn:document.getElementById("notify-btn"),themeToggle:document.getElementById("theme-toggle"),weatherSection:document.getElementById("weather"),favoritesSection:document.getElementById("favorites-section"),favoritesList:document.getElementById("favorites-list"),favoriteBtn:document.getElementById("favorite-btn"),cityName:document.getElementById("city-name"),temperature:document.getElementById("temperature"),weatherIcon:document.getElementById("weather-icon"),wind:document.getElementById("wind"),humidity:document.getElementById("humidity"),feelsLike:document.getElementById("feels-like"),hourlyList:document.getElementById("hourly-list"),loading:document.getElementById("loading"),errorMessage:document.getElementById("error-message")};let B=null;document.addEventListener("DOMContentLoaded",()=>{g(),_()});async function _(){if("serviceWorker"in navigator)try{const e=await navigator.serviceWorker.register("./service-worker.js");console.log("‚úÖ Service Worker enregistr√©:",e.scope)}catch(e){console.error("‚ùå Erreur Service Worker:",e)}}function L(){return"Notification"in window&&typeof Notification<"u"}function g(){if(!L()){t.notifyBtn.textContent="üîî Non disponible (iOS)",t.notifyBtn.disabled=!0;return}if(!("Notification"in window)){t.notifyBtn.textContent="üîî Notifications non support√©es",t.notifyBtn.disabled=!0;return}const e=Notification.permission;e==="granted"?(t.notifyBtn.textContent="‚úÖ Notifications activ√©es",t.notifyBtn.classList.add("granted"),t.notifyBtn.classList.remove("denied")):e==="denied"?(t.notifyBtn.textContent="‚ùå Notifications bloqu√©es",t.notifyBtn.classList.add("denied"),t.notifyBtn.classList.remove("granted")):(t.notifyBtn.textContent="üîî Activer les notifications",t.notifyBtn.classList.remove("granted","denied"))}async function N(){if(!("Notification"in window)){c("Les notifications ne sont pas support√©es par votre navigateur.");return}if(Notification.permission==="denied"){c("Les notifications sont bloqu√©es. Veuillez les r√©activer dans les param√®tres de votre navigateur.");return}try{const e=await Notification.requestPermission();g(),e==="granted"&&new Notification("M√©t√©oPWA",{body:"Les notifications sont maintenant activ√©es ! üéâ",icon:"icons/icon-192.png",tag:"welcome"})}catch(e){console.error("Erreur lors de la demande de permission:",e)}}async function C(){const e=t.cityInput.value.trim();if(!e){c("Veuillez entrer un nom de ville.");return}p(),w();try{const s=await fetch(`${l.GEOCODING_API}?name=${encodeURIComponent(e)}&count=1&language=fr&format=json`);if(!s.ok)throw new Error("Erreur de g√©ocodage");const i=await s.json();if(!i.results||i.results.length===0)throw new Error(`Ville "${e}" non trouv√©e. V√©rifiez l'orthographe.`);const o=i.results[0],n=`${o.name}${o.admin1?", "+o.admin1:""}, ${o.country}`;await O(o.latitude,o.longitude,n)}catch(s){m(),c(s.message)}}async function O(e,s,i){p(),w();try{const o=await fetch(`${l.WEATHER_API}?latitude=${e}&longitude=${s}&current=temperature_2m,relative_humidity_2m,apparent_temperature,weather_code,wind_speed_10m&hourly=temperature_2m,weather_code,precipitation_probability&timezone=auto&forecast_days=1`);if(!o.ok)throw new Error("Erreur lors de la r√©cup√©ration des donn√©es m√©t√©o");const n=await o.json();B={name:i,lat:e,lon:s},x(n,i),S(n,i),m()}catch(o){m(),c(o.message)}}function x(e,s){const i=e.current,o=e.hourly;t.cityName.textContent=s,t.temperature.textContent=Math.round(i.temperature_2m),t.weatherIcon.textContent=y(i.weather_code),t.wind.textContent=`${Math.round(i.wind_speed_10m)} km/h`,t.humidity.textContent=`${i.relative_humidity_2m} %`,t.feelsLike.textContent=`${Math.round(i.apparent_temperature)}¬∞C`;const n=new Date().getHours(),r=[];for(let a=0;a<4;a++){const d=n+a+1;if(d<o.time.length){const E=new Date(o.time[d]),f=o.temperature_2m[d],h=o.weather_code[d],v=l.RAIN_CODES.includes(h),I=f>l.TEMP_THRESHOLD;let u="";v?u="rain-alert":I&&(u="temp-alert"),r.push(`
                <div class="hourly-item ${u}">
                    <div class="hourly-time text-size-display-small text-weight-bold">${E.getHours()}h</div>
                    <div class="hourly-icon text-size-display-small">${y(h)}</div>
                    <div class="hourly-temp text-size-display-small">${Math.round(f)}¬∞C</div>
                </div>
            `)}}t.hourlyList.innerHTML=r.join(""),t.weatherSection.classList.remove("hidden")}function S(e,s){const i=e.hourly,o=new Date().getHours();for(let n=1;n<=4;n++){const r=o+n;r<i.time.length&&(i.weather_code[r],i.temperature_2m[r])}}function y(e){return{0:"‚òÄÔ∏è",1:"üå§Ô∏è",2:"‚õÖ",3:"‚òÅÔ∏è",45:"üå´Ô∏è",48:"üå´Ô∏è",51:"üå¶Ô∏è",53:"üå¶Ô∏è",55:"üåßÔ∏è",56:"üå®Ô∏è",57:"üå®Ô∏è",61:"üåßÔ∏è",63:"üåßÔ∏è",65:"üåßÔ∏è",66:"üå®Ô∏è",67:"üå®Ô∏è",71:"üå®Ô∏è",73:"üå®Ô∏è",75:"‚ùÑÔ∏è",77:"üå®Ô∏è",80:"üå¶Ô∏è",81:"üåßÔ∏è",82:"‚õàÔ∏è",85:"üå®Ô∏è",86:"‚ùÑÔ∏è",95:"‚õàÔ∏è",96:"‚õàÔ∏è",99:"‚õàÔ∏è"}[e]||"üå§Ô∏è"}function p(){t.loading.classList.remove("hidden"),t.weatherSection.classList.add("hidden")}function m(){t.loading.classList.add("hidden")}function c(e){t.errorMessage.textContent=e,t.errorMessage.classList.remove("hidden")}function w(){t.errorMessage.classList.add("hidden")}t.searchBtn.addEventListener("click",e=>{C()});t.notifyBtn.addEventListener("click",e=>{N()});
