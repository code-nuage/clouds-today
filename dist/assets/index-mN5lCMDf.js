(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function o(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=o(n);fetch(n.href,s)}})();const d={GEOCODING_API:"https://geocoding-api.open-meteo.com/v1/search",WEATHER_API:"https://api.open-meteo.com/v1/forecast",STORAGE_KEY_FAVORITES:"meteo-pwa-favorites",STORAGE_KEY_THEME:"meteo-pwa-theme",RAIN_CODES:[51,53,55,56,57,61,63,65,66,67,71,73,75,77,80,81,82,85,86,95,96,99],TEMP_THRESHOLD:10},t={cityInput:document.getElementById("city-input"),searchBtn:document.getElementById("search-btn"),notifyBtn:document.getElementById("notify-btn"),themeToggle:document.getElementById("theme-toggle"),weatherSection:document.getElementById("weather"),favoritesSection:document.getElementById("favorites-section"),favoritesList:document.getElementById("favorites-list"),favoriteBtn:document.getElementById("favorite-btn"),cityName:document.getElementById("city-name"),temperature:document.getElementById("temperature"),weatherIcon:document.getElementById("weather-icon"),wind:document.getElementById("wind"),humidity:document.getElementById("humidity"),feelsLike:document.getElementById("feels-like"),hourlyList:document.getElementById("hourly-list"),loading:document.getElementById("loading"),errorMessage:document.getElementById("error-message")};let B=null;document.addEventListener("DOMContentLoaded",()=>{w(),L()});async function L(){if("serviceWorker"in navigator)try{const e=await navigator.serviceWorker.register("./service-worker.js");console.log("‚úÖ Service Worker enregistr√©:",e.scope)}catch(e){console.error("‚ùå Erreur Service Worker:",e)}}function C(){return"Notification"in window&&typeof Notification<"u"}function w(){if(!C()){t.notifyBtn.textContent="üîî Non disponible (iOS)",t.notifyBtn.disabled=!0;return}if(!("Notification"in window)){t.notifyBtn.textContent="üîî Notifications non support√©es",t.notifyBtn.disabled=!0;return}const e=Notification.permission;e==="granted"?(t.notifyBtn.textContent="‚úÖ Notifications activ√©es",t.notifyBtn.classList.add("granted"),t.notifyBtn.classList.remove("denied")):e==="denied"?(t.notifyBtn.textContent="‚ùå Notifications bloqu√©es",t.notifyBtn.classList.add("denied"),t.notifyBtn.classList.remove("granted")):(t.notifyBtn.textContent="üîî Activer les notifications",t.notifyBtn.classList.remove("granted","denied"))}async function N(){if(!("Notification"in window)){f("Les notifications ne sont pas support√©es par votre navigateur.");return}if(Notification.permission==="denied"){f("Les notifications sont bloqu√©es. Veuillez les r√©activer dans les param√®tres de votre navigateur.");return}try{const e=await Notification.requestPermission();w(),e==="granted"&&new Notification("M√©t√©oPWA",{body:"Les notifications sont maintenant activ√©es ! üéâ",icon:"icons/icon-192.png",tag:"welcome"})}catch(e){console.error("Erreur lors de la demande de permission:",e)}}function g(e,r,o="info"){new Notification("Clouds today ? "+e,{type:o,body:r})}async function O(){const e=t.cityInput.value.trim();if(!e){f("Veuillez entrer un nom de ville.");return}v(),I();try{const r=await fetch(`${d.GEOCODING_API}?name=${encodeURIComponent(e)}&count=1&language=fr&format=json`);if(!r.ok)throw new Error("Erreur de g√©ocodage");const o=await r.json();if(!o.results||o.results.length===0)throw new Error(`Ville "${e}" non trouv√©e. V√©rifiez l'orthographe.`);const i=o.results[0],n=`${i.name}${i.admin1?", "+i.admin1:""}, ${i.country}`;await S(i.latitude,i.longitude,n)}catch(r){y(),f(r.message)}}async function S(e,r,o){v(),I();try{const i=await fetch(`${d.WEATHER_API}?latitude=${e}&longitude=${r}&current=temperature_2m,relative_humidity_2m,apparent_temperature,weather_code,wind_speed_10m&hourly=temperature_2m,weather_code,precipitation_probability&timezone=auto&forecast_days=1`);if(!i.ok)throw new Error("Erreur lors de la r√©cup√©ration des donn√©es m√©t√©o");const n=await i.json();B={name:o,lat:e,lon:r},$(n,o),H(n,o),y()}catch(i){y(),f(i.message)}}function $(e,r){const o=e.current,i=e.hourly;t.cityName.textContent=r,t.temperature.textContent=Math.round(o.temperature_2m),t.weatherIcon.textContent=E(o.weather_code),t.wind.textContent=`${Math.round(o.wind_speed_10m)} km/h`,t.humidity.textContent=`${o.relative_humidity_2m} %`,t.feelsLike.textContent=`${Math.round(o.apparent_temperature)}¬∞C`;const n=new Date().getHours(),s=[];for(let a=0;a<4;a++){const c=n+a+1;if(c<i.time.length){const l=new Date(i.time[c]),u=i.temperature_2m[c],h=i.weather_code[c],m=d.RAIN_CODES.includes(h),_=u>d.TEMP_THRESHOLD;let p="";m?p="rain-alert":_&&(p="temp-alert"),s.push(`
                <div class="hourly-item ${p}">
                    <div class="hourly-time text-size-display-small text-weight-bold">${l.getHours()}h</div>
                    <div class="hourly-icon text-size-display-small">${E(h)}</div>
                    <div class="hourly-temp text-size-display-small">${Math.round(u)}¬∞C</div>
                </div>
            `)}}t.hourlyList.innerHTML=s.join(""),t.weatherSection.classList.remove("hidden")}function H(e,r){const o=e.hourly,i=new Date().getHours();let n=!1,s=!1,a=null,c=null;for(let l=1;l<=4;l++){const u=i+l;if(u<o.time.length){const h=o.weather_code[u],m=o.temperature_2m[u];console.log(m),!n&&d.RAIN_CODES.includes(h)&&(n=!0,a=l),!s&&m>d.TEMP_THRESHOLD&&(s=!0,c=Math.round(m))}}n&&g(r,`üåßÔ∏è Pluie pr√©vue dans ${a} heure${a>1?"s":""} !`,"rain"),s&&g(r,`üå°Ô∏è Temp√©rature sup√©rieure √† ${d.TEMP_THRESHOLD}¬∞C pr√©vue (${c}¬∞C)`,"temp")}function E(e){return{0:"‚òÄÔ∏è",1:"üå§Ô∏è",2:"‚õÖ",3:"‚òÅÔ∏è",45:"üå´Ô∏è",48:"üå´Ô∏è",51:"üå¶Ô∏è",53:"üå¶Ô∏è",55:"üåßÔ∏è",56:"üå®Ô∏è",57:"üå®Ô∏è",61:"üåßÔ∏è",63:"üåßÔ∏è",65:"üåßÔ∏è",66:"üå®Ô∏è",67:"üå®Ô∏è",71:"üå®Ô∏è",73:"üå®Ô∏è",75:"‚ùÑÔ∏è",77:"üå®Ô∏è",80:"üå¶Ô∏è",81:"üåßÔ∏è",82:"‚õàÔ∏è",85:"üå®Ô∏è",86:"‚ùÑÔ∏è",95:"‚õàÔ∏è",96:"‚õàÔ∏è",99:"‚õàÔ∏è"}[e]||"üå§Ô∏è"}function v(){t.loading.classList.remove("hidden"),t.weatherSection.classList.add("hidden")}function y(){t.loading.classList.add("hidden")}function f(e){t.errorMessage.textContent=e,t.errorMessage.classList.remove("hidden")}function I(){t.errorMessage.classList.add("hidden")}t.searchBtn.addEventListener("click",e=>{O()});t.notifyBtn.addEventListener("click",e=>{N()});
